<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zepto unit tests</title>
    <script src="../zepto.js"></script>
    <script src="evidence.js"></script>
</head>
<body>

<h1>Zepto unit tests</h1>
<p>
    See the browser console for results.
</p>
<div id="some_element"></div>
<p>
    <span class="yay">yay</span>
    <span></span>
    <span class="nay" id="nay">nay</span>
</p>
<script>
    function click (el) {
        var event = document.createEvent("MouseEvents");
        event.initMouseEvent('click', true, true, document.defaultView, 1, 0, 0, 0, 0, false, false, false, false, 0, null);
        el.dispatchEvent(event);
    }

    Evidence.TestCase.extend('Zepto', {

        testDollar: function (t) {
            t.assert($('#some_element').get().length === 1);
            t.assert($('#some_element').get(0) === document.getElementById('some_element'));

            t.assert($('span').get().length === 3);
            t.assert($('p>span.nay').get().length === 1);
        },

        testCss: function (t) {
            var el = $('#some_element').get(0);

            $('#some_element').css('color:#f00;border:1px solid rgba(255,0,0,1)');
            t.assertEqual('rgb(255, 0, 0)', el.style.color);
            t.assertEqual('rgb(255, 0, 0)', el.style.borderLeftColor);
            t.assertEqual('1px', el.style.borderLeftWidth);
        },

        testLive: function (t) {
            var counter = 0, pcounter = 0;
            $('#some_element').live('click', function () { counter++ });
            $('span.yay').live('click', function () { counter++ });
            $('p').live('click', function () { pcounter++ });

            click($('#some_element').get(0));
            t.assertEqual(1, counter);

            click($('span.yay').get(0));
            t.assertEqual(2, counter);

            click($('span.nay').get(0));
            t.assertEqual(2, counter);

            click($('p').get(0));
            t.assertEqual(3, pcounter);
        },

        testChaining: function (t) {
            t.assert(document.getElementById('nay').innerHTML === 'nay');
            $('span.nay').css('color:red').html('test');
            t.assert(document.getElementById('nay').innerHTML === 'test');
        },

        testCachingForLater: function (t) {
            var one = $('div');
            var tow = $('span');

            t.assert(one.get(0) !== tow.get(0));
        },

        testPlugins: function (t) {
            var el = $('#some_element').get(0);

            $.fn.plugin = function () {
                return this(function (el) { el.innerHTML = 'plugin!'; });
            };
            $('#some_element').plugin();
            t.assertEqual('plugin!', el.innerHTML);
        }

    });
</script>

</body>
</html>